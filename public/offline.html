<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuildMate Studio - Offline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .offline-container {
            max-width: 500px;
            width: 100%;
        }
        
        .offline-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            opacity: 0.8;
        }
        
        .offline-icon svg {
            width: 100%;
            height: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 300;
        }
        
        p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .features {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
        }
        
        .features h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .features ul {
            list-style: none;
            text-align: left;
        }
        
        .features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
        }
        
        .features li::before {
            content: "âœ“";
            margin-right: 10px;
            color: #4ade80;
            font-weight: bold;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
        }
        
        .btn-primary:hover {
            background: white;
        }
        
        .status {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .connection-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .online {
            background: #4ade80;
        }
        
        .offline {
            background: #ef4444;
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="offline-container">
        <div class="offline-icon">
            <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="40" stroke="white" stroke-width="2" fill="none" opacity="0.6"/>
                <path d="M30 50 L45 65 L70 35" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="50" cy="50" r="20" fill="rgba(255,255,255,0.1)"/>
            </svg>
        </div>
        
        <h1>You're Offline</h1>
        <p>Don't worry! BuildMate Studio works offline too. Your work is automatically saved locally and will sync when you reconnect.</p>
        
        <div class="features">
            <h3>Available Offline:</h3>
            <ul>
                <li>View and edit your projects</li>
                <li>Code generation with cached AI responses</li>
                <li>Local file management</li>
                <li>Cached project templates</li>
                <li>Offline documentation</li>
            </ul>
        </div>
        
        <div class="status">
            <span class="connection-indicator offline"></span>
            <span id="status-text">Connection lost - Working offline</span>
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="tryReconnect()">Try to Reconnect</button>
            <button class="btn" onclick="goToProjects()">View Projects</button>
            <button class="btn" onclick="clearCache()">Clear Cache</button>
        </div>
    </div>

    <script>
        let isOnline = navigator.onLine;
        
        function updateConnectionStatus() {
            const indicator = document.querySelector('.connection-indicator');
            const statusText = document.getElementById('status-text');
            
            if (navigator.onLine) {
                indicator.className = 'connection-indicator online';
                statusText.textContent = 'Connection restored - Syncing data...';
                
                // Try to reload after a short delay
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
            } else {
                indicator.className = 'connection-indicator offline';
                statusText.textContent = 'Connection lost - Working offline';
            }
        }
        
        function tryReconnect() {
            const btn = event.target;
            btn.textContent = 'Checking...';
            btn.disabled = true;
            
            // Try to fetch a simple endpoint
            fetch('/api/health', { cache: 'no-cache' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        throw new Error('Server error');
                    }
                })
                .catch(() => {
                    btn.textContent = 'Still Offline';
                    setTimeout(() => {
                        btn.textContent = 'Try to Reconnect';
                        btn.disabled = false;
                    }, 2000);
                });
        }
        
        function goToProjects() {
            // Try to navigate to projects page
            window.location.href = '/projects';
        }
        
        function clearCache() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                const channel = new MessageChannel();
                channel.port1.onmessage = (event) => {
                    if (event.data.success) {
                        alert('Cache cleared! The page will reload.');
                        window.location.reload();
                    }
                };
                
                navigator.serviceWorker.controller.postMessage(
                    { type: 'CLEAR_CACHE' },
                    [channel.port2]
                );
            } else {
                // Fallback for browsers without service worker support
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => {
                            if (name.startsWith('buildmate-')) {
                                caches.delete(name);
                            }
                        });
                    });
                }
                alert('Cache cleared! Please refresh the page.');
            }
        }
        
        // Listen for online/offline events
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // Update status on load
        updateConnectionStatus();
        
        // Periodic connection check
        setInterval(() => {
            if (!navigator.onLine) {
                // Try a simple fetch to check actual connectivity
                fetch('/api/health', { 
                    cache: 'no-cache',
                    mode: 'no-cors'
                }).then(() => {
                    if (!navigator.onLine) {
                        // Force online status if fetch succeeds
                        window.dispatchEvent(new Event('online'));
                    }
                }).catch(() => {
                    // Still offline
                });
            }
        }, 10000); // Check every 10 seconds
    </script>
</body>
</html>