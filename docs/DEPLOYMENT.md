# Deployment Guide

This guide covers how to deploy applications generated by BuildMate Studio to various platforms.

## Overview

BuildMate generates production-ready applications that can be deployed to:
- Vercel (recommended for React apps)
- Netlify
- AWS (S3 + CloudFront, Amplify, or EC2)
- Replit
- Lovable
- Custom hosting

## Prerequisites

Before deploying, ensure you have:
- Generated application code from BuildMate
- Account on your chosen platform
- Environment variables configured
- Database set up (if applicable)

## Deployment Platforms

### Vercel (Recommended)

Vercel provides the best experience for React + TypeScript applications generated by BuildMate.

#### Via GitHub Integration

1. **Push code to GitHub** (BuildMate can do this automatically)
2. **Connect Vercel to your repository**
   ```bash
   # Or use Vercel CLI
   npm install -g vercel
   vercel login
   vercel
   ```

3. **Configure environment variables** in Vercel dashboard:
   - `DATABASE_URL`
   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
   - Any other required variables

4. **Deploy**
   ```bash
   vercel --prod
   ```

#### Automatic Deployment

BuildMate can deploy directly to Vercel:

```typescript
// In BuildMate UI or API
await project.deploy({
  platform: 'vercel',
  environment: 'production',
  envVars: {
    DATABASE_URL: process.env.DATABASE_URL,
    SUPABASE_URL: process.env.SUPABASE_URL,
    SUPABASE_ANON_KEY: process.env.SUPABASE_ANON_KEY
  }
});
```

#### Custom Domain

1. Add domain in Vercel dashboard
2. Configure DNS records:
   ```
   A     @     76.76.21.21
   CNAME www   cname.vercel-dns.com
   ```

### Netlify

Deploy to Netlify for serverless functions and edge network benefits.

#### Via CLI

```bash
# Install Netlify CLI
npm install -g netlify-cli

# Login
netlify login

# Initialize
netlify init

# Deploy
netlify deploy --prod
```

#### Configuration

Create `netlify.toml`:

```toml
[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### AWS

Deploy to AWS for enterprise-grade infrastructure.

#### S3 + CloudFront (Static Sites)

```bash
# Build app
npm run build

# Upload to S3
aws s3 sync dist/ s3://your-bucket-name

# Invalidate CloudFront cache
aws cloudfront create-invalidation \
  --distribution-id YOUR_DIST_ID \
  --paths "/*"
```

#### AWS Amplify

```bash
# Install Amplify CLI
npm install -g @aws-amplify/cli

# Initialize
amplify init

# Add hosting
amplify add hosting

# Deploy
amplify publish
```

### Replit

Deploy to Replit for instant hosting with zero configuration.

#### Via Replit UI

1. Open project in Replit
2. Click "Deploy" button
3. Choose deployment type:
   - **Autoscale**: Variable traffic (recommended)
   - **Reserved VM**: Constant availability
   - **Static**: Static sites only

#### Via API

```typescript
await project.deploy({
  platform: 'replit',
  deploymentType: 'autoscale'
});
```

### Lovable

Deploy to Lovable for AI-optimized hosting.

```bash
# Install Lovable CLI
npm install -g lovable-cli

# Login
lovable login

# Deploy
lovable deploy
```

### Custom Hosting

Deploy to any VPS or server with Node.js.

#### Build and Deploy

```bash
# Build application
npm run build

# Copy to server
scp -r dist/ user@server:/var/www/myapp

# On server, set up nginx
sudo nano /etc/nginx/sites-available/myapp
```

#### Nginx Configuration

```nginx
server {
    listen 80;
    server_name myapp.com;
    root /var/www/myapp;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy (if needed)
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## Environment Variables

### Required Variables

All BuildMate-generated apps need these variables:

```bash
# Database
DATABASE_URL=postgres://user:pass@host:5432/db

# Supabase (if using Supabase)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key

# API Keys (if using external services)
STRIPE_SECRET_KEY=sk_live_...
SENDGRID_API_KEY=SG...
```

### Platform-Specific Configuration

#### Vercel

Set in Vercel dashboard or via CLI:
```bash
vercel env add DATABASE_URL production
```

#### Netlify

Set in Netlify dashboard or `netlify.toml`:
```toml
[build.environment]
  DATABASE_URL = "postgres://..."
```

#### AWS Amplify

Set in Amplify console or `.env.production`:
```bash
DATABASE_URL=postgres://...
```

## Database Setup

### Supabase

1. **Create project** at [supabase.com](https://supabase.com)
2. **Run migrations**
   ```bash
   npm run db:push
   ```
3. **Copy connection details**
   - Project URL → `SUPABASE_URL`
   - Anon key → `SUPABASE_ANON_KEY`

### Neon DB

1. **Create database** at [neon.tech](https://neon.tech)
2. **Copy connection string**
   ```bash
   DATABASE_URL=postgresql://user:pass@host/db?sslmode=require
   ```
3. **Run migrations**
   ```bash
   npm run db:push
   ```

### PostgreSQL (Self-Hosted)

```bash
# Create database
createdb myapp_production

# Run migrations
DATABASE_URL=postgresql://localhost/myapp_production npm run db:push
```

## CI/CD Integration

### GitHub Actions

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
          vercel-args: '--prod'
```

### GitLab CI

Create `.gitlab-ci.yml`:

```yaml
stages:
  - build
  - deploy

build:
  stage: build
  script:
    - npm ci
    - npm run build
  artifacts:
    paths:
      - dist/

deploy:
  stage: deploy
  script:
    - npm install -g vercel
    - vercel --token $VERCEL_TOKEN --prod
  only:
    - main
```

## Rollback Strategy

### Vercel

```bash
# List deployments
vercel ls

# Rollback to previous
vercel rollback
```

### Netlify

```bash
# List deploys
netlify deploys list

# Restore deploy
netlify deploys restore <deploy-id>
```

### Manual Rollback

```bash
# Checkout previous version
git checkout previous-version-tag

# Redeploy
vercel --prod
```

## Monitoring

### Health Checks

Add health check endpoint:

```typescript
// api/health.ts
export default function handler(req, res) {
  res.status(200).json({ 
    status: 'healthy',
    timestamp: new Date().toISOString()
  });
}
```

### Error Tracking

#### Sentry

```typescript
// Install
npm install @sentry/react

// Initialize
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "your-sentry-dsn",
  environment: process.env.NODE_ENV
});
```

#### LogRocket

```typescript
// Install
npm install logrocket

// Initialize
import LogRocket from 'logrocket';

LogRocket.init('your-app-id');
```

## Performance Optimization

### Build Optimization

```typescript
// vite.config.ts
export default {
  build: {
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true
      }
    },
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          ui: ['@radix-ui/react-dialog', /* ... */]
        }
      }
    }
  }
}
```

### CDN Configuration

#### Vercel

Automatic CDN with 100+ edge locations.

#### Cloudflare

```bash
# Add Cloudflare as DNS provider
# Enable proxy (orange cloud)
# Configure cache rules in dashboard
```

## Security

### Environment Variables

Never commit secrets:
```bash
# .gitignore
.env
.env.local
.env.production
```

### HTTPS

All platforms provide automatic HTTPS. For custom hosting:

```bash
# Install certbot
sudo apt-get install certbot python3-certbot-nginx

# Get certificate
sudo certbot --nginx -d myapp.com -d www.myapp.com
```

### Security Headers

Add to `vercel.json`:

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    }
  ]
}
```

## Troubleshooting

### Build Fails

```bash
# Check build logs
vercel logs <deployment-url>

# Common issues:
# - Missing environment variables
# - TypeScript errors
# - Dependency conflicts
```

### Runtime Errors

```bash
# Check runtime logs
vercel logs --follow

# Enable debug mode
DEBUG=* npm run build
```

### Database Connection Issues

```bash
# Test connection
psql $DATABASE_URL

# Check firewall rules
# Check SSL requirements
# Verify credentials
```

## Best Practices

1. **Use environment variables** for all secrets
2. **Enable automatic deployments** from main branch
3. **Test in staging** before production
4. **Monitor performance** with analytics
5. **Set up error tracking** from day one
6. **Configure health checks** for uptime monitoring
7. **Use CDN** for static assets
8. **Enable HTTPS** always
9. **Set up backups** for database
10. **Document deployment process** for team

## Related Documentation

- [BuildMate API](./API.md) - Programmatic deployment
- [Spec Format](./SPEC_FORMAT.md) - Application specifications
- [Design Integration](./DESIGN_INTEGRATION.md) - Design tokens

---

**Questions?** Check our [deployment troubleshooting guide](https://docs.buildmate-studio.com/troubleshooting) or contact support.
